# ุงูุณูุงุญ ุจุงูุงุดุชุฑุงูุงุช ุงููุชุนุฏุฏุฉ ูู ูุฆุงุช ูุฎุชููุฉ

## ุงููุดููุฉ ุงูุณุงุจูุฉ
ูุงู ุงููุธุงู ูููุน ุงููุณุชุฎุฏู ูู ุงูุงุดุชุฑุงู ูุฑุฉ ุฃุฎุฑู ุฅุฐุง ูุงู ูุฏูู ุฃู ุงุดุชุฑุงู ูุดุทุ ุญุชู ูู ูุงู ูู ูุฆุฉ ุฃู ููุน ูุฎุชูู.

## ุงูุญู ุงูุฌุฏูุฏ
ุงูุขู ุงููุธุงู ูุณูุญ ูููุณุชุฎุฏู ุจุงูุงุดุชุฑุงู ูู ูุฆุงุช ูุฃููุงุน ูุชุนุฏุฏุฉ ูู ููุณ ุงูููุช!

## ููู ูุนูู ุงููุธุงู ุงูุขู

### ุงูุณููุงุฑูู 1: ุงุดุชุฑุงู ุฌุฏูุฏ ุชูุงูุงู
```
ุงููุณุชุฎุฏู: user@example.com
ุงูุงุดุชุฑุงู: ุฏุฑูุณ ูุธุฑูุฉ - ูุฆุฉ B
ุงููุชูุฌุฉ: โ ุชู ุฅูุดุงุก ุงููุณุชุฎุฏู ูุงูุงุดุชุฑุงู ุจูุฌุงุญ
```

### ุงูุณููุงุฑูู 2: ุฅุถุงูุฉ ุงุดุชุฑุงู ุซุงูู (ูุฆุฉ ูุฎุชููุฉ)
```
ุงููุณุชุฎุฏู: user@example.com (ููุฌูุฏ)
ุงูุงุดุชุฑุงู ุงูุญุงูู: ุฏุฑูุณ ูุธุฑูุฉ - ูุฆุฉ B
ุงูุงุดุชุฑุงู ุงูุฌุฏูุฏ: ุงูุชุญุงูุงุช - ูุฆุฉ A
ุงููุชูุฌุฉ: โ ุชู ุฅุถุงูุฉ ุงูุงุดุชุฑุงู ุงูุฌุฏูุฏ ุจูุฌุงุญ
```

### ุงูุณููุงุฑูู 3: ุฅุถุงูุฉ ุงุดุชุฑุงู ุซุงูุซ (ููุน ูุฎุชูู)
```
ุงููุณุชุฎุฏู: user@example.com (ููุฌูุฏ)
ุงูุงุดุชุฑุงูุงุช ุงูุญุงููุฉ:
  - ุฏุฑูุณ ูุธุฑูุฉ - ูุฆุฉ B
  - ุงูุชุญุงูุงุช - ูุฆุฉ A
ุงูุงุดุชุฑุงู ุงูุฌุฏูุฏ: ุฏุฑูุณ ุนูููุฉ - ููุฏูููุงุช
ุงููุชูุฌุฉ: โ ุชู ุฅุถุงูุฉ ุงูุงุดุชุฑุงู ุงูุฌุฏูุฏ ุจูุฌุงุญ
```

### ุงูุณููุงุฑูู 4: ูุญุงููุฉ ุงูุงุดุชุฑุงู ูู ููุณ ุงูููุน ูุงููุฆุฉ
```
ุงููุณุชุฎุฏู: user@example.com (ููุฌูุฏ)
ุงูุงุดุชุฑุงู ุงูุญุงูู: ุฏุฑูุณ ูุธุฑูุฉ - ูุฆุฉ B (ูุดุท)
ุงูุงุดุชุฑุงู ุงูุฌุฏูุฏ: ุฏุฑูุณ ูุธุฑูุฉ - ูุฆุฉ B
ุงููุชูุฌุฉ: โ ูุฏูู ุจุงููุนู ุงุดุชุฑุงู ูุดุท ูู ูุฐู ุงููุฆุฉ!
```

## ุงูุชุบููุฑุงุช ุงูุชูููุฉ

### 1. ุงูุชุญูู ูู ุงูุงุดุชุฑุงู ุงูููุงุซู ููุท
```typescript
// ูุจู: ูุงู ูุชุญูู ูู ุฃู ุงุดุชุฑุงู ูุดุท
if (existingUser && isActive) {
  return "ุฃูุช ูุดุชุฑู ุจุงููุนู!";
}

// ุจุนุฏ: ูุชุญูู ูู ุงุดุชุฑุงู ููุงุซู ููุท (ููุณ ุงูููุน + ููุณ ุงููุฆุฉ)
const existingSubscription = await prisma.subscription.findUnique({
  where: {
    userId_subscriptionType_category: {
      userId: existingUser.id,
      subscriptionType: body.subscriptionType,
      category: body.category
    }
  }
});

if (existingSubscription && isActive) {
  return "ูุฏูู ุจุงููุนู ุงุดุชุฑุงู ูุดุท ูู ูุฐู ุงููุฆุฉ!";
}
```

### 2. ุชุญุฏูุซ ุจูุงูุงุช ุงููุณุชุฎุฏู ุจุฐูุงุก
```typescript
if (existingUser) {
  // ุชุญุฏูุซ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ููุท
  user = await prisma.user.update({
    where: { email },
    data: {
      name: body.fullName,
      password: body.password,
      phone: body.phone,
      // ุงูุญููู ุงููุฏููุฉ ุชูุญุฏุซ ุจุขุฎุฑ ุงุดุชุฑุงู (ููุชูุงูู)
      category: body.category || existingUser.category,
      subscriptionType: body.subscriptionType || existingUser.subscriptionType,
      // ...
    }
  });
} else {
  // ุฅูุดุงุก ูุณุชุฎุฏู ุฌุฏูุฏ
  user = await prisma.user.create({ ... });
}
```

### 3. ุฅุถุงูุฉ ุงูุงุดุชุฑุงู ูู ุฌุฏูู Subscriptions
```typescript
// ูุชู ุฅุถุงูุฉ/ุชุญุฏูุซ ุงูุงุดุชุฑุงู ูู ุฌุฏูู ูููุตู
await prisma.subscription.upsert({
  where: {
    userId_subscriptionType_category: {
      userId: user.id,
      subscriptionType: body.subscriptionType,
      category: body.category
    }
  },
  update: { expiryDate, isActive: true },
  create: { userId, subscriptionType, category, expiryDate }
});
```

## ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ูุณุชุฎุฏู ูุฑูุฏ ุฏุฑูุณ B ูุงูุชุญุงูุงุช A
```
ุงูุฎุทูุฉ 1: ุงูุงุดุชุฑุงู ูู ุฏุฑูุณ ูุธุฑูุฉ ูุฆุฉ B
- ุงูุจุฑูุฏ: student@example.com
- ุงูููุน: theorie
- ุงููุฆุฉ: B
- ุงููุชูุฌุฉ: โ ุชู ุจูุฌุงุญ

ุงูุฎุทูุฉ 2: ุงูุงุดุชุฑุงู ูู ุงูุชุญุงูุงุช ูุฆุฉ A
- ุงูุจุฑูุฏ: student@example.com (ููุณ ุงูุจุฑูุฏ)
- ุงูููุน: examen
- ุงููุฆุฉ: A
- ุงููุชูุฌุฉ: โ ุชู ุจูุฌุงุญ

ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:
- ุงููุณุชุฎุฏู ูุฏูู ุงุดุชุฑุงููู ูุดุทูู
- ุนูุฏ ุชุณุฌูู ุงูุฏุฎููุ ูุฎุชุงุฑ ุฃู ุงุดุชุฑุงู ูุฑูุฏ ุงุณุชุฎุฏุงูู
```

### ูุซุงู 2: ูุณุชุฎุฏู ูุฑูุฏ ูู ุดูุก
```
ุงูุงุดุชุฑุงูุงุช:
1. ุฏุฑูุณ ูุธุฑูุฉ - ูุฆุฉ B โ
2. ุงูุชุญุงูุงุช - ูุฆุฉ B โ
3. ุฏุฑูุณ ุนูููุฉ - ููุฏูููุงุช โ
4. ุฏุฑูุณ ุนูููุฉ - ุฅุฏุฑุงู ุงููุฎุงุทุฑ โ

ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:
- ูุฑู ูุงุฆูุฉ ุจุฌููุน ุงูุงุดุชุฑุงูุงุช ุงูุฃุฑุจุนุฉ
- ูุฎุชุงุฑ ุงูุงุดุชุฑุงู ุงูุฐู ูุฑูุฏ ุงุณุชุฎุฏุงูู
```

## ุงูููุงุฆุฏ

1. **ูุฑููุฉ ูุงููุฉ**: ุงููุณุชุฎุฏู ููููู ุงูุงุดุชุฑุงู ูู ุฃู ุนุฏุฏ ูู ุงููุฆุงุช ูุงูุฃููุงุน
2. **ููุน ุงูุชูุฑุงุฑ**: ูุง ูููู ุงูุงุดุชุฑุงู ูู ููุณ ุงูููุน ูุงููุฆุฉ ูุฑุชูู
3. **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู**: ุฑุณุงูุฉ ูุงุถุญุฉ ุนูุฏ ูุญุงููุฉ ุงูุงุดุชุฑุงู ุงูููุฑุฑ
4. **ุฅุฏุงุฑุฉ ุณููุฉ**: ูู ุงุดุชุฑุงู ูู ุชุงุฑูุฎ ุงูุชูุงุก ูููุตู

## ุฑุณุงุฆู ุงููุธุงู

### ุนูุฏ ูุฌุงุญ ุงูุงุดุชุฑุงู:
```
โ ุชู ุงูุงุดุชุฑุงู ุจูุฌุงุญ!
๐ User can now have multiple active subscriptions!
```

### ุนูุฏ ูุญุงููุฉ ุงูุงุดุชุฑุงู ุงูููุฑุฑ:
```
โ ูุฏูู ุจุงููุนู ุงุดุชุฑุงู ูุดุท ูู ูุฐู ุงููุฆุฉ! ููููู ุงูุงุดุชุฑุงู ูู ูุฆุฉ ุฃุฎุฑู.
```

## Console Logs ููุชุชุจุน

```
๐ฅ Received request: { email: "user@example.com", forceRenew: false }
๐ Existing user check: { exists: true, email: "user@example.com" }
โ Existing user updated
โ Subscription created/updated successfully
๐ User can now have multiple active subscriptions!
```

## ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุงุดุชุฑุงู ูู ูุฆุชูู ูุฎุชููุชูู
1. ุงุดุชุฑู ูู ุฏุฑูุณ ูุธุฑูุฉ ูุฆุฉ B
2. ุงุณุชุฎุฏู ููุณ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
3. ุงุดุชุฑู ูู ุงูุชุญุงูุงุช ูุฆุฉ A
4. ุงููุชูุฌุฉ: ูุฌุจ ุฃู ููุฌุญ ุงูุงุดุชุฑุงูุงู

### ุงุฎุชุจุงุฑ 2: ูุญุงููุฉ ุงูุงุดุชุฑุงู ุงูููุฑุฑ
1. ุงุดุชุฑู ูู ุฏุฑูุณ ูุธุฑูุฉ ูุฆุฉ B
2. ุงุณุชุฎุฏู ููุณ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
3. ุญุงูู ุงูุงุดุชุฑุงู ูู ุฏุฑูุณ ูุธุฑูุฉ ูุฆุฉ B ูุฑุฉ ุฃุฎุฑู
4. ุงููุชูุฌุฉ: ูุฌุจ ุฃู ูุธูุฑ ุฎุทุฃ "ูุฏูู ุจุงููุนู ุงุดุชุฑุงู ูุดุท"

### ุงุฎุชุจุงุฑ 3: ุชุณุฌูู ุงูุฏุฎูู ูุน ุงุดุชุฑุงูุงุช ูุชุนุฏุฏุฉ
1. ุงุดุชุฑู ูู 3 ูุฆุงุช ูุฎุชููุฉ
2. ุณุฌู ุงูุฏุฎูู
3. ุงููุชูุฌุฉ: ูุฌุจ ุฃู ุชุธูุฑ ูุงุฆูุฉ ุจุงูุงุดุชุฑุงูุงุช ุงูุซูุงุซุฉ

## ููุงุญุธุงุช ูููุฉ

1. **ุงูุญููู ุงููุฏููุฉ ูู ุฌุฏูู User**: ุชูุญุฏุซ ุจุขุฎุฑ ุงุดุชุฑุงู ููุชูุงูู ูุน ุงูููุฏ ุงููุฏูู
2. **ุฌุฏูู Subscriptions**: ูุญุชูู ุนูู ุฌููุน ุงูุงุดุชุฑุงูุงุช ุงููุดุทุฉ
3. **ุงูุชุญูู ุงูุฐูู**: ูุชุญูู ููุท ูู ุงูุงุดุชุฑุงู ุงูููุงุซู (ููุณ ุงูููุน + ููุณ ุงููุฆุฉ)
4. **ุงููุฑููุฉ**: ูููู ูููุณุชุฎุฏู ุงูุงุดุชุฑุงู ูู ุฃู ุนุฏุฏ ูู ุงููุฆุงุช

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู User (ููุชูุงูู):
```sql
SELECT * FROM "User" WHERE email = 'user@example.com';
-- ูุญุชูู ุนูู ุขุฎุฑ ุงุดุชุฑุงู ููุท
```

### ุฌุฏูู Subscription (ุงูุงุดุชุฑุงูุงุช ุงููุนููุฉ):
```sql
SELECT * FROM "Subscription" 
WHERE "userId" = (SELECT id FROM "User" WHERE email = 'user@example.com')
AND "isActive" = true;
-- ูุญุชูู ุนูู ุฌููุน ุงูุงุดุชุฑุงูุงุช ุงููุดุทุฉ
```

## ุงูุฎูุงุตุฉ

ุงููุธุงู ุงูุขู ูุฏุนู ุจุงููุงูู ุงูุงุดุชุฑุงูุงุช ุงููุชุนุฏุฏุฉ! ุงููุณุชุฎุฏู ููููู:
- โ ุงูุงุดุชุฑุงู ูู ุฏุฑูุณ ูุธุฑูุฉ ููุฆุงุช ูุฎุชููุฉ
- โ ุงูุงุดุชุฑุงู ูู ุงูุชุญุงูุงุช ููุฆุงุช ูุฎุชููุฉ
- โ ุงูุงุดุชุฑุงู ูู ุฏุฑูุณ ุนูููุฉ
- โ ุงูุฌูุน ุจูู ุฃู ุนุฏุฏ ูู ุงูุงุดุชุฑุงูุงุช
- โ ูุง ูููู ุงูุงุดุชุฑุงู ูู ููุณ ุงูููุน ูุงููุฆุฉ ูุฑุชูู (ููุน ุงูุชูุฑุงุฑ)
