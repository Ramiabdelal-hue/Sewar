# Admin Subscribers Dashboard - Complete Search System

## الميزات المتوفرة:

### 1. البحث بالاسم أو البريد الإلكتروني
- قائمة منسدلة تحتوي على جميع الأسماء والإيميلات المتاحة
- يمكن الاختيار من القائمة أو الكتابة للبحث
- البحث يدعم البحث الجزئي (case-insensitive)

### 2. البحث بالشهر
- اختيار الشهر والسنة من حقل التاريخ
- يبحث في تاريخ إنشاء الاشتراكات (subscriptions.createdAt)
- يعرض جميع المشتركين الذين أنشأوا اشتراكات في هذا الشهر

### 3. البحث بنوع الاشتراك
- دروس نظرية (theorie)
- امتحانات (examen)
- دروس عملية - فيديوهات (praktijk-lessons)
- دروس عملية - إدراك المخاطر (praktijk-exam)

### 4. البحث بالفئة
- فئة A
- فئة B
- فئة C

## كيفية عمل البحث:

### البحث المركب (Combined Search):
يمكن استخدام جميع الفلاتر معاً للحصول على نتائج دقيقة:
- مثال: البحث عن مشتركين في فئة B + نوع theorie + شهر معين

### آلية البحث في API:

```typescript
// البحث بالاسم أو البريد
if (searchName) {
  whereConditions.OR = [
    { name: { contains: searchName, mode: 'insensitive' } },
    { email: { contains: searchName, mode: 'insensitive' } }
  ];
}

// البحث بالشهر (في تاريخ إنشاء الاشتراكات)
if (searchMonth) {
  whereConditions.subscriptions = {
    some: {
      createdAt: {
        gte: startDate,
        lte: endDate
      },
      isActive: true
    }
  };
}

// البحث بالفئة
if (searchCategory) {
  whereConditions.subscriptions.some.category = searchCategory;
}

// البحث بنوع الاشتراك
if (searchType) {
  whereConditions.subscriptions.some.subscriptionType = searchType;
}
```

## الإحصائيات المعروضة:

### 1. إجمالي المشتركين
- عدد جميع المستخدمين الذين لديهم اشتراكات نشطة

### 2. إجمالي الإيرادات
- حساب المبلغ الإجمالي بناءً على أسعار الباقات:
  - theorie: €25
  - examen: €25
  - praktijk-lessons: €49
  - praktijk-exam: €39

### 3. عدد الفئات
- عرض عدد المشتركين في كل فئة (A, B, C)
- تفاصيل العدد لكل فئة

## الملفات المعدلة:

### 1. `app/admin/subscribers/page.tsx`
- إضافة فلتر نوع الاشتراك
- تحديث واجهة البحث لتكون 4 أعمدة
- إضافة console.log لتتبع البحث

### 2. `app/api/admin/subscribers/route.ts`
- إصلاح البحث بالشهر ليبحث في subscriptions.createdAt
- إضافة دعم البحث بنوع الاشتراك
- دمج جميع شروط البحث في subscriptions.some

## كيفية الاستخدام:

### 1. البحث بالاسم أو البريد:
- انقر على الحقل وستظهر قائمة بجميع الأسماء
- اختر من القائمة أو ابدأ بالكتابة

### 2. البحث بالشهر:
- اختر الشهر والسنة
- سيتم البحث في تاريخ إنشاء الاشتراكات

### 3. البحث بنوع الاشتراك:
- اختر نوع الاشتراك من القائمة المنسدلة
- يمكن دمجه مع الفئة للحصول على نتائج دقيقة

### 4. البحث بالفئة:
- اختر الفئة (A, B, أو C)
- يمكن دمجه مع نوع الاشتراك

### 5. مسح الفلاتر:
- انقر على زر "مسح الفلاتر" لإعادة تعيين جميع الفلاتر

## أمثلة على البحث:

### مثال 1: البحث عن مشتركين في دروس نظرية فئة B
- نوع الاشتراك: theorie
- الفئة: B

### مثال 2: البحث عن مشتركين في شهر معين
- الشهر: 2026-02
- سيعرض جميع من أنشأوا اشتراكات في فبراير 2026

### مثال 3: البحث عن مشترك معين في فئة معينة
- الاسم: اسم المشترك
- الفئة: A
- نوع الاشتراك: examen

## ملاحظات مهمة:

1. البحث بالشهر يبحث في تاريخ إنشاء الاشتراكات وليس تاريخ تسجيل المستخدم
2. جميع الفلاتر تعمل معاً بشكل تراكمي
3. البحث يعرض فقط الاشتراكات النشطة (isActive: true)
4. الإحصائيات تُحدث تلقائياً بناءً على نتائج البحث
5. يمكن رؤية رسائل التتبع في console للتأكد من شروط البحث
